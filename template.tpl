___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Securiti, Inc. CMP",
  "brand": {
    "id": "github.com_SecuritiCMP",
    "displayName": "SecuritiCMP",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAABOCAYAAACKX/AgAAAMPmlDQ1BJQ0MgUHJvZmlsZQAASImVVwdYU8kWnluSkEBoAQSkhN4EESkBpITQQu8INkISIJQQA0HFjiwquBZULGBDV0UUrIDYETuLYu8LKgrKuliwK29SQNd95Xsn39z7558z/zlz7twyAKid5IhE2ag6ADnCfHFMkB99fFIyndQDEPgjAE1gz+HmiZhRUWEA2tD57/buJvSFds1eqvXP/v9qGjx+HhcAJAriVF4eNwfigwDgVVyROB8AopQ3m5YvkmLYgJYYJgjxIilOl+MqKU6V470yn7gYFsStACipcDjidABUr0CeXsBNhxqq/RA7CnkCIQBqdIi9c3JyeRCnQGwNfUQQS/UZqT/opP9NM3VYk8NJH8byuchMyV+QJ8rmzPg/y/G/LSdbMhTDEjaVDHFwjHTOsG63s3JDpVgF4j5hakQkxJoQfxDwZP4Qo5QMSXC83B814OaxYM2ADsSOPI5/KMQGEAcKsyPCFHxqmiCQDTFcIeh0QT47DmJdiBfx8wJiFT6bxbkxilhoQ5qYxVTw5zliWVxprIeSrHimQv91Bp+t0MdUCzPiEiGmQGxeIEiIgFgVYoe8rNhQhc+4wgxWxJCPWBIjzd8c4hi+MMhPro8VpIkDYxT+pTl5Q/PFNmcI2BEKvD8/Iy5YXh+slcuR5Q/ngl3hC5nxQzr8vPFhQ3Ph8f0D5HPHevjC+FiFzgdRvl+MfCxOEWVHKfxxU352kJQ3hdg5ryBWMRZPyIcLUq6Pp4nyo+LkeeKFmZyQKHk++HIQBljAH9CBBLZUkAsygaC9r7EP/pP3BAIOEIN0wAf2CmZoRKKsRwiPsaAQ/AkRH+QNj/OT9fJBAeS/DrPyoz1Ik/UWyEZkgacQ54BQkA3/S2SjhMPREsATyAj+EZ0DGxfmmw2btP/f80Psd4YJmTAFIxmKSFcb8iQGEP2JwcRAog2uj3vjnngYPPrC5oQzcPeheXz3JzwldBAeEW4QOgl3pgiKxD9lGQ46oX6gohapP9YCt4SaLrgf7gXVoTKug+sDe9wZxmHiPjCyC2RZirylVaH/pP23GfxwNRR+ZEcySh5B9iVb/zxS1VbVZVhFWusf6yPPNXW43qzhnp/js36oPg+eQ3/2xBZhB7Bz2CnsAnYUawR07ATWhLVhx6R4eHU9ka2uoWgxsnyyoI7gH/GGrqy0knmOtY69jl/kffn86dJnNGDlimaIBekZ+XQmfCPw6Wwh12EU3cnRyRkA6ftF/vh6Ey17byA6bd+5BX8A4HVicHDwyHcu5AQA+9zg7X/4O2fNgK8OZQDOH+ZKxAVyDpceCPApoQbvND1gBMyANZyPE3AFnsAXBIAQEAniQBKYDLPPgOtcDKaBWWA+KAFlYDlYDdaDTWAr2An2gP2gERwFp8BZcAlcATfAPbh6usEL0A/egc8IgpAQKkJD9BBjxAKxQ5wQBuKNBCBhSAyShKQg6YgQkSCzkAVIGVKOrEe2IDXIPuQwcgq5gHQgd5AupBd5jXxCMVQF1UINUUt0NMpAmWgoGodOQtPRqWghWowuRdei1ehutAE9hV5Cb6Cd6At0AAOYMqaDmWD2GANjYZFYMpaGibE5WClWgVVjdVgzvM7XsE6sD/uIE3EaTsft4QoOxuNxLj4Vn4MvwdfjO/EGvBW/hnfh/fg3ApVgQLAjeBDYhPGEdMI0QgmhgrCdcIhwBt5L3YR3RCJRh2hFdIP3YhIxkziTuIS4gVhPPEnsID4mDpBIJD2SHcmLFEnikPJJJaR1pN2kE6SrpG7SByVlJWMlJ6VApWQloVKRUoXSLqXjSleVnil9JquTLcge5EgyjzyDvIy8jdxMvkzuJn+maFCsKF6UOEomZT5lLaWOcoZyn/JGWVnZVNldOVpZoDxPea3yXuXzyl3KH1U0VWxVWCoTVSQqS1V2qJxUuaPyhkqlWlJ9qcnUfOpSag31NPUh9YMqTdVBla3KU52rWqnaoHpV9aUaWc1Cjak2Wa1QrULtgNpltT51srqlOkudoz5HvVL9sPot9QENmsYYjUiNHI0lGrs0Lmj0aJI0LTUDNHmaxZpbNU9rPqZhNDMai8alLaBto52hdWsRtay02FqZWmVae7Tatfq1NbWdtRO0p2tXah/T7tTBdCx12DrZOst09uvc1Pk0wnAEcwR/xOIRdSOujnivO1LXV5evW6pbr3tD95MeXS9AL0tvhV6j3gN9XN9WP1p/mv5G/TP6fSO1RnqO5I4sHbl/5F0D1MDWIMZgpsFWgzaDAUMjwyBDkeE6w9OGfUY6Rr5GmUarjI4b9RrTjL2NBcarjE8YP6dr05n0bPpaeiu938TAJNhEYrLFpN3ks6mVabxpkWm96QMzihnDLM1slVmLWb+5sXm4+SzzWvO7FmQLhkWGxRqLcxbvLa0sEy0XWjZa9ljpWrGtCq1qre5bU619rKdaV1tftyHaMGyybDbYXLFFbV1sM2wrbS/boXaudgK7DXYdowij3EcJR1WPumWvYs+0L7Cvte9y0HEIcyhyaHR4Odp8dPLoFaPPjf7m6OKY7bjN8d4YzTEhY4rGNI957WTrxHWqdLo+ljo2cOzcsU1jXznbOfOdNzrfdqG5hLssdGlx+erq5ip2rXPtdTN3S3GrcrvF0GJEMZYwzrsT3P3c57ofdf/o4eqR77Hf4y9Pe88sz12ePeOsxvHHbRv32MvUi+O1xavTm+6d4r3Zu9PHxIfjU+3zyNfMl+e73fcZ04aZydzNfOnn6Cf2O+T3nuXBms066Y/5B/mX+rcHaAbEB6wPeBhoGpgeWBvYH+QSNDPoZDAhODR4RfAttiGby65h94e4hcwOaQ1VCY0NXR/6KMw2TBzWHI6Gh4SvDL8fYREhjGiMBJHsyJWRD6KsoqZGHYkmRkdFV0Y/jRkTMyvmXCwtdkrsrth3cX5xy+LuxVvHS+JbEtQSJibUJLxP9E8sT+wcP3r87PGXkvSTBElNyaTkhOTtyQMTAiasntA90WViycSbk6wmTZ90YbL+5OzJx6aoTeFMOZBCSElM2ZXyhRPJqeYMpLJTq1L7uSzuGu4Lni9vFa+X78Uv5z9L80orT+tJ90pfmd6b4ZNRkdEnYAnWC15lBmduynyfFZm1I2swOzG7PkcpJyXnsFBTmCVszTXKnZ7bIbITlYg6p3pMXT21Xxwq3p6H5E3Ka8rXgh/ybRJryS+SrgLvgsqCD9MSph2YrjFdOL1thu2MxTOeFQYW/jYTn8md2TLLZNb8WV2zmbO3zEHmpM5pmWs2t3hu97ygeTvnU+Znzf+9yLGovOjtgsQFzcWGxfOKH/8S9EttiWqJuOTWQs+FmxbhiwSL2hePXbxu8bdSXunFMseyirIvS7hLLv465te1vw4uTVvavsx12cblxOXC5TdX+KzYWa5RXlj+eGX4yoZV9FWlq96unrL6QoVzxaY1lDWSNZ1rw9Y2rTNft3zdl/UZ629U+lXWVxlULa56v4G34epG3411mww3lW36tFmw+faWoC0N1ZbVFVuJWwu2Pt2WsO3cb4zfarbrby/b/nWHcEfnzpidrTVuNTW7DHYtq0VrJbW9uyfuvrLHf09TnX3dlnqd+rK9YK9k7/N9Kftu7g/d33KAcaDuoMXBqkO0Q6UNSMOMhv7GjMbOpqSmjsMhh1uaPZsPHXE4suOoydHKY9rHlh2nHC8+Pnii8MTASdHJvlPppx63TGm5d3r86eut0a3tZ0LPnD8bePb0Oea5E+e9zh+94HHh8EXGxcZLrpca2lzaDv3u8vuhdtf2hstul5uuuF9p7hjXcfyqz9VT1/yvnb3Ovn7pRsSNjpvxN2/fmnir8zbvds+d7Duv7hbc/Xxv3n3C/dIH6g8qHho8rP7D5o/6TtfOY13+XW2PYh/de8x9/OJJ3pMv3cVPqU8rnhk/q+lx6jnaG9h75fmE590vRC8+95X8qfFn1Uvrlwf/8v2rrX98f/cr8avB10ve6L3Z8db5bctA1MDDdznvPr8v/aD3YedHxsdznxI/Pfs87Qvpy9qvNl+bv4V+uz+YMzgo4og5sk8BDDY0LQ2A1zsAoCYBQIP7M8oE+f5PZoh8zypD4D9h+R5RZq4A1MHv9+g++HVzC4C92+D2C+qrTQQgigpAnDtAx44dbkN7Ndm+UmpEuA/YHPU1NScV/BuT7zl/yPvnM5CqOoOfz/8C0hR8UlCzluYAAACKZVhJZk1NACoAAAAIAAQBGgAFAAAAAQAAAD4BGwAFAAAAAQAAAEYBKAADAAAAAQACAACHaQAEAAAAAQAAAE4AAAAAAAAAkAAAAAEAAACQAAAAAQADkoYABwAAABIAAAB4oAIABAAAAAEAAABMoAMABAAAAAEAAABOAAAAAEFTQ0lJAAAAU2NyZWVuc2hvdJOQFRQAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAHUaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjc4PC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjc2PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6VXNlckNvbW1lbnQ+U2NyZWVuc2hvdDwvZXhpZjpVc2VyQ29tbWVudD4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cs1TQdMAAAAcaURPVAAAAAIAAAAAAAAAJwAAACgAAAAnAAAAJwAAAo/vfBnpAAACW0lEQVR4AeyZMVLDMBREnZK0MKGipiA5BRegI9wFKrgLoeMCnCKhoKYiQ1oowetEMx6NbO9+SyYTpCK2ZFlaPe2XbGf0U6YiJ5rAKAOjWVUVMzCNV5GBZWAiAbF6dlgGJhIQq2eHZWAiAbF6b4et1l9Vl6uP7RGZ6em4mE7GopT41VNoMwODmKflpljugIWGO58eV8Xz2UnocpIyRhc6hjaLLhOwxfKzWKw20oBTwmMh+YJnZRTcX575xa15Gdjdy3urq1p7212MAc8KKaTvoYTGLiESMIuzQgLrZQq8mJDqGnD+fHPuFwXzNLAUsHxFCJGLyVFVjI0DCZvJ6/q7t6urxlp+2PCkgV09vrV0dxiXmNCkgA3hrn1AzrgsA/Nmqmsto4DF2Bk9XXubzcDEqelax7LDPKBRHPZfFn2wiwIMD4y35RP+oadou+RQwCDYJfcAi4dWpLaXfHdP3yPzQk6tYRCSaqcEpOvZ9qtG1/sclgYk9cW/uon46QpHNEEDi+0yB6oLUmicKcAx4fhnwBjrh0D5ZTE3I1YT7TCIjRGWrDAfTlM+lvOZcIQGCVhfcbFhOYh9dbHhOCiwVLBiQFO0SQ6DOEtYKoIcAMvRuqax4QhNMjCL/RVBFlD1e9Tvdko4DgLM4i5MivvbTv1nR3WZqk92GCgrYam4q2mw6qAUlyn6TA5LBYyZhK5PL9CGxLSFemo44h6Tw9h1jHVGk7MgsJ7YAcbWV9dgAoYGGNszwFhYTjTTJguMdazrG0czMMb2jCAVGOsyZkLV9WsvgDHg6zOMc2agqYD9AgAA//+W7p0EAAACiUlEQVTtmjFSAkEQRZdQUi2MjA2EU3gBM/EuGuldxMwLeAowMDaSkhRD3U/RsLXA7v+9vRQWMwGzLDPTv9/8GWbRzm9eMkcZjb+z0WRW2fPp+iLr97qVbR7ePrPxdF7Zpvzh691l+dbG+5vnj417xRuDXNdjrk8tHS8wJtE2gLGJ1gEDKAZ8GagbGCOIATbJ3XWfu4wtw/5pNhycVTZnx2T0lQO5gLGCWDcwboVwdjxmu8B4ewPGCmITZCeATTBaH+BacTmMWY4WgE0S7XclyoK3mIo+dR+TgbFuMPFqsuiHGJOvedY/79Z+y1ocq3dBt8/LtTKh6CsDUwUhiCoKfbxFcRdiqBMqA1MFeUR5YXkmE7GUCZWAqcuxmDhzHCi2V6+9sBCnNWBNRKnCFGBNJhJxlGUpOcyzHMuJRzutKSzTx7qMBhYlDAKjoDV1vMFCHQ4sUpwJ9YLD5L2MZ/JDu8XdVrPLknZYxHLcJhT3AK7uzAVIKNGgFoMuXxiXUcDacFdRaPEaM41y1TvJ3qc/q4/Un4BWHYWLfwlMyC+8KbMsKYexvyaEZ7DnAcOAtbl/7ZlJbbi6h3HKYQnYmjMF7FiWJLCEOCwBEx0Wecpfhz68K+YgTS1JpHYM+1jdcgQHGtg+Dq/4WseBFad+FPzqaqXub6DWzlsz7sLYNDA0bmMvA6TbQf5otDzhI86ugq0BEKPhMecv0yQBi9rLFEgmtFxHwVO1SMBMtGd5qsIsFlN74SnOMh0uYOgMaIu64v8r2oS0CL7lxeDhwX3XA3sTXW5gptUE2nvbsJk9yfq0WZu+KF2NgbWZ7CGOnYCJs5KAJWAiAbF5clgCJhIQmyeHJWAiAbF5cpgI7A/YBOxEMyitYAAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Add Securiti\u0027s Consent Management Platform (CMP) to your website via Google Tag Manager, and integrate seamlessly with Google Consent Mode with this easy-to-use template.",
  "categories": [
    "TAG_MANAGEMENT",
    "PERSONALIZATION"
  ],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "enableConsentMode",
    "displayName": "Enable Consent Mode?",
    "radioItems": [
      {
        "value": true,
        "displayValue": "Yes"
      },
      {
        "value": false,
        "displayValue": "No"
      }
    ],
    "simpleValueType": true,
    "defaultValue": true,
    "help": "Enable Google Consent Mode Integration with Securiti"
  },
  {
    "type": "GROUP",
    "name": "defaultConsentState",
    "displayName": "Default Consent Overrides",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "ad_storage",
        "displayName": "ad_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Enables storage, such as cookies, related to advertising."
      },
      {
        "type": "SELECT",
        "name": "ad_user_data",
        "displayName": "ad_user_data",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Sets consent for sending user data to Google for online advertising purposes."
      },
      {
        "type": "SELECT",
        "name": "ad_personalization",
        "displayName": "ad_personalization",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Sets consent for personalized advertising."
      },
      {
        "type": "SELECT",
        "name": "analytics_storage",
        "displayName": "analytics_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Enables storage, such as cookies, related to analytics (for example, visit duration)."
      },
      {
        "type": "SELECT",
        "name": "functionality_storage",
        "displayName": "functionality_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Enables storage that supports the functionality of the website or app such as language settings."
      },
      {
        "type": "SELECT",
        "name": "personalization_storage",
        "displayName": "personalization_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Enables storage related to personalization such as video recommendations."
      },
      {
        "type": "SELECT",
        "name": "security_storage",
        "displayName": "security_storage",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "denied"
          },
          {
            "value": "granted",
            "displayValue": "granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Enables storage related to security such as authentication functionality, fraud prevention, and other user protection"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "enableConsentMode",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "defaultConsentStateByRegion",
    "displayName": "Region-Specific Default Consent Overrides",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "region",
          "displayName": "Enter region codes, separated by commas.",
          "simpleValueType": true,
          "valueHint": "eg. in, us-ca, de",
          "valueValidators": [
            {
              "type": "NON_EMPTY"
            }
          ],
          "help": "eg. in, us-ca, de"
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "SELECT",
          "name": "ad_storage",
          "displayName": "ad_storage",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "help": "Enables storage, such as cookies, related to advertising.",
          "defaultValue": "Use global default",
          "valueValidators": [
            {
              "type": "NON_EMPTY"
            }
          ]
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "ad_user_data",
          "displayName": "ad_user_data",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "help": "Sets consent for sending user data to Google for online advertising purposes.",
          "defaultValue": "Use global default"
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "ad_personalization",
          "displayName": "ad_personalization",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "help": "Sets consent for personalized advertising.",
          "defaultValue": "Use global default"
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "analytics_storage",
          "displayName": "analytics_storage",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "help": "Enables storage, such as cookies, related to analytics (for example, visit duration).",
          "defaultValue": "Use global default"
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "functionality_storage",
          "displayName": "functionality_storage",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "help": "Enables storage that supports the functionality of the website or app such as language settings.",
          "defaultValue": "Use global default"
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "personalization_storage",
          "displayName": "personalization_storage",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "help": "Enables storage related to personalization such as video recommendations.",
          "defaultValue": "Use global default"
        },
        "isUnique": false
      },
      {
        "param": {
          "type": "SELECT",
          "name": "security_storage",
          "displayName": "security_storage",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "denied",
              "displayValue": "denied"
            },
            {
              "value": "granted",
              "displayValue": "granted"
            },
            {
              "value": "Use global default",
              "displayValue": "Use global default"
            }
          ],
          "simpleValueType": true,
          "defaultValue": "Use global default",
          "help": "Enables storage related to security such as authentication functionality, fraud prevention, and other user protection"
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add region-specific default",
    "newRowTitle": "Add region-specific default",
    "help": "If you would like to have different default consent rules per region, you can enter those defaults here. Any region that is not defined will automatically take the global default set in the \u0027defaultConsent\u0027 section.",
    "enablingConditions": [
      {
        "paramName": "enableConsentMode",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// The first two lines are optional, use if you want to enable logging
const log = require('logToConsole');
log('data =', data);

const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const getCookieValues = require('getCookieValues');
const fromBase64 = require('fromBase64');
const JSON = require('JSON');
const createQueue = require('createQueue');
const Object = require('Object');
const gtagSet = require('gtagSet');
const COOKIE_NAME = '__privaci_cookie_consents';
const CONSENT_MESSAGE_TYPE = 'consent_given';
const GCM_CONSENT_JSON_KEY = 'gcm';
const GCM_CONSENT_GRANTED = 'granted';
const GCM_CONSENT_DENIED = 'denied';
const consentTypeIdMap = {
    '-2': 'wait_for_update',
    '-1': 'region',
    '1': 'ad_storage',
    '2': 'ad_user_data',
    '3': 'ad_personalization',
    '4': 'analytics_storage',
    '5': 'functionality_storage',
    '6': 'personalization_storage',
    '7': 'security_storage'
};
const consentTypeNameMap = {};
Object.entries(consentTypeIdMap).forEach(pair => {
    consentTypeNameMap[pair[1]] = pair[0];
});

const getGcmCookieValue = (a) => {
    const cookieValue = getCookieValues(COOKIE_NAME);
    if (typeof cookieValue === 'undefined' || !cookieValue) {
        return {};
    }
    return cookieValue && cookieValue.length > 0 ? decodeCookie(cookieValue[0]) : {};
};

const decodeCookie = (val) => {
    log('decodeValue', val);
    if (val.charAt(0) !== '{') {
        val = fromBase64(val);
    }

    const consentObj = JSON.parse(val);
    if (consentObj && consentObj[GCM_CONSENT_JSON_KEY]) {
        log('GCM_CONSENT_JSON', consentObj[GCM_CONSENT_JSON_KEY]);
        return consentObj[GCM_CONSENT_JSON_KEY];
    }

    log('No Consent Found for GCM', consentObj);
    return {};
};

/*
 *   Called when consent changes. Assumes that consent object contains keys which
 *   directly correspond to Google consent types.
 */
const onUserConsent = (consent) => {
    if (!consent || typeof consent !== 'object') {
        return;
    }
    let gcmConsent = {};

    Object.entries(consent).forEach(pair => {
        const cs = (pair[1] === GCM_CONSENT_GRANTED || pair[1] === true || pair[1] === 1 || pair[1] === '1') ? GCM_CONSENT_GRANTED : GCM_CONSENT_DENIED;
        if (consentTypeNameMap[pair[0]]) {
            gcmConsent[pair[0]] = cs;
        } else if (consentTypeIdMap[pair[0]]) {
            gcmConsent[consentTypeIdMap[pair[0]]] = cs;
        }
    });

    if (Object.keys(gcmConsent).length > 0) {
        log('gcmConsent Set', gcmConsent);
        updateConsentState(gcmConsent);
    }
};

const parseRegionString = (regionCsv) => {
    return regionCsv.split(",")
        .map(regCode => regCode.trim().toUpperCase())
        .filter(regCode => regCode != "");
};

/*
 *   Executes the default command, sets the developer ID, and sets up the consent
 *   update callback
 */
const initConsentMode = (data) => {
    log('Setting up Google Consent Mode defaults');

    gtagSet('developer_id.TODO', true);

    // Set default consent state(s) - This come from GTM (not from CMP)
    let defaultState = {"wait_for_update": 500};
    Object.entries(data).forEach(pair => {
        if (consentTypeNameMap[pair[0]] && (pair[1] === GCM_CONSENT_GRANTED || pair[1] === GCM_CONSENT_DENIED)) {
            defaultState[pair[0]] = pair[1];
        }
    });
    setDefaultConsentState(defaultState);
    log('Done setting up Global defaults', defaultState);

    // Set default consent state(s) By REGION - This come from GTM (not from CMP)
    data.defaultConsentStateByRegion && data.defaultConsentStateByRegion.forEach(regionRecord => {
        let geoCodes = parseRegionString(regionRecord.region);
        let hasRegionOverride = false;
        let regionalDefault = {
            "wait_for_update": 500,
            "region": geoCodes
        };

        Object.entries(regionRecord).forEach(e => {
            if ((e[1] === GCM_CONSENT_GRANTED || e[1] === GCM_CONSENT_DENIED) && e[0] !== "region") {
                regionalDefault[e[0]] = e[1];
                hasRegionOverride = true;
            }
        });

        if (hasRegionOverride) {
          setDefaultConsentState(regionalDefault);
          log('Done setting up Region defaults', regionalDefault);
        }
    });

    // Check if cookie is set (by CMP) and has values that correspond to Google consent mode
    const gcmConsent = getGcmCookieValue(COOKIE_NAME);
    if (gcmConsent && typeof gcmConsent === 'object') {
        onUserConsent(gcmConsent);
    }

    /**
     * Add event listener to trigger update when consent changes
     *  'message'
     */
    const onConsentCallbackFunc = function(data) {
        onUserConsent(data);
    };

    const callbackQueue = createQueue('__privaci_ccmp_callback_queue');
    callbackQueue({type: 'gcm_consent_given', callback: onConsentCallbackFunc});

};

if (data.enableConsentMode === true || data.enableConsentMode === 'true') {
  initConsentMode(data);
}
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__privaci_ccmp_callback_queue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "developer_id.TODO"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "__privaci_cookie_consents"
              },
              {
                "type": 1,
                "string": "__privaci_cookie_consent_generated"
              },
              {
                "type": 1,
                "string": "__privaci_cookie_consent_uuid"
              },
              {
                "type": 1,
                "string": "__privaci_latest_published_version"
              },
              {
                "type": 1,
                "string": "__privaci_cookie_no_action"
              },
              {
                "type": 1,
                "string": "__privaci_iab_tcf_version"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 05/02/2024, 09:44:52


